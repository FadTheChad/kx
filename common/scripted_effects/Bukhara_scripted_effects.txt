TRK_change_centralisation = {
	if = {
		limit = { 
			has_country_flag = TRK_centralisation_of_emirate
			TRK_alim_khan_in_power = yes 
		}
		# convert percent to absolute
		if = {
			limit = {
				check_variable = { TRK_centralisation_change > -1 }
				check_variable = { TRK_centralisation_change < 1 }
			}
			multiply_temp_variable = { TRK_centralisation_change = 100 }
		}

		# tooltip
		effect_tooltip = {
			add_to_variable = {
				TRK_centralisation = TRK_centralisation_change
				tooltip = TRK_centralisation_tooltip
			}
		}

		# lower limit = legitimacy * -1
		set_temp_variable = { TRK_lower_limit = TRK_centralisation }
		multiply_temp_variable = { TRK_lower_limit = -1 }

		# upper limit = 100 - legitimacy
		set_temp_variable = { TRK_upper_limit = 100 }
		subtract_from_temp_variable = { TRK_upper_limit = TRK_centralisation }

		# avoid values outside the allowed range
		clamp_temp_variable = {
			var = TRK_centralisation_change
			min = TRK_lower_limit
			max = TRK_upper_limit
		}

		# add the variable
		add_to_variable = { TRK_centralisation = TRK_centralisation_change }
	}
}
TRK_change_decentralisation = {
	if = {
		limit = { 
			has_country_flag = TRK_decentralisation_of_emirate
			TRK_alim_khan_in_power = yes 
		}
		# convert percent to absolute
		if = {
			limit = {
				check_variable = { TRK_decentralisation_change > -1 }
				check_variable = { TRK_decentralisation_change < 1 }
			}
			multiply_temp_variable = { TRK_decentralisation_change = 100 }
		}

		# tooltip
		effect_tooltip = {
			add_to_variable = {
				TRK_decentralisation = TRK_decentralisation_change
				tooltip = TRK_decentralisation_tooltip
			}
		}

		# lower limit = legitimacy * -1
		set_temp_variable = { TRK_lower_limit = TRK_decentralisation }
		multiply_temp_variable = { TRK_lower_limit = -1 }

		# upper limit = 100 - legitimacy
		set_temp_variable = { TRK_upper_limit = 100 }
		subtract_from_temp_variable = { TRK_upper_limit = TRK_decentralisation }

		# avoid values outside the allowed range
		clamp_temp_variable = {
			var = TRK_decentralisation_change
			min = TRK_lower_limit
			max = TRK_upper_limit
		}

		# add the variable
		add_to_variable = { TRK_decentralisation = TRK_decentralisation_change }
	}
}
TRK_increase_kushbegi = {
	custom_effect_tooltip = TRK_increase_kushbegi
	add_to_variable = { TRK_kushbegi = 1 }
	add_to_variable = { TRK_karaulbegi = -1 }
}
TRK_increase_karaulbegi = {
	custom_effect_tooltip = TRK_increase_karaulbegi
	add_to_variable = { TRK_karaulbegi = 1 }
	add_to_variable = { TRK_kushbegi = -1 }
}
TRK_decrease_kushbegi = {
	custom_effect_tooltip = TRK_decrease_kushbegi
	add_to_variable = { TRK_kushbegi = -1 }
	add_to_variable = { TRK_karaulbegi = 1 }
}
TRK_decrease_karaulbegi = {
	custom_effect_tooltip = TRK_decrease_karaulbegi
	add_to_variable = { TRK_karaulbegi = -1 }
	add_to_variable = { TRK_kushbegi = 1 }
}
TRK_increase_reformists = {
	if = {
		limit = {
			NOT = { has_country_flag = TRK_antireformist_coup }
		}
		custom_effect_tooltip = TRK_increase_reformists
		add_to_variable = { TRK_reformists = 1 }
	}
}
TRK_decrease_reformists = {
	if = {
		limit = {
			NOT = { has_country_flag = TRK_antireformist_coup }
		}
		custom_effect_tooltip = TRK_decrease_reformists
		add_to_variable = { TRK_reformists = -1 }
	}
}
TRK_closer_to_chaos = {
	if = {
		limit = {
			TRK_alim_khan_in_power = yes
		}
		if = {
			limit = {
				check_variable = { TRK_chaos > 3 }
			}
			custom_effect_tooltip = TRK_closer_to_chaos_yellow
			add_to_variable = { TRK_chaos = -1 }
		}
		else_if = {
			limit = {
				check_variable = { TRK_chaos < 4 }
				check_variable = { TRK_chaos > 1 }
			}
			custom_effect_tooltip = TRK_closer_to_chaos_red
			add_to_variable = { TRK_chaos = -1 }
		}
		else = {
			custom_effect_tooltip = TRK_closer_to_chaos_dead
			add_to_variable = { TRK_chaos = -1 }
			if = {
				limit = {
					has_country_flag = TRK_young_bukhara_radical
					OR = {
						is_ai = no
						AND = {
							is_ai = yes
							NOT = {
								has_game_rule = {
									rule = TRK_PATH
									option = TRK_PATH_ABS_MON
								}
								has_game_rule = {
									rule = TRK_PATH
									option = TRK_PATH_ABS_MON_IBRAHIM
								}
							}
						}
					}
				}
				hidden_effect = {
					country_event = {
						id = bukhara.50
						days = 2
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						is_ai = no
						AND = {
							is_ai = yes
							NOT = {
								has_game_rule = {
									rule = TRK_PATH
									option = TRK_PATH_ABS_MON
								}
								has_game_rule = {
									rule = TRK_PATH
									option = TRK_PATH_ABS_MON_IBRAHIM
								}
							}
						}
					}
				}
				hidden_effect = {
					country_event = {
						id = bukhara.15
						days = 2
					}
				}
			}
		}
	}
}

TRK_decrease_largest_begi = {
	if = {
		limit = { 
			check_variable = { TRK_karaulbegi > TRK_kushbegi }
		}
		TRK_decrease_karaulbegi = yes
	}
	else = {
		TRK_decrease_kushbegi = yes
	}
}
TRK_decrease_black_monday = {
	custom_effect_tooltip = TRK_decrease_black_monday
	hidden_effect = {
		if = {
			limit = { has_idea = TRK_black_monday_4 }
			remove_ideas = TRK_black_monday_4
			add_timed_idea = {
				idea = TRK_black_monday_5
				days = 365
			}
		}
		else_if = {
			limit = { has_idea = TRK_black_monday_3 }
			swap_ideas = {
				remove_idea = TRK_black_monday_3
				add_idea = TRK_black_monday_4
			}
		}
		else_if = {
			limit = { has_idea = TRK_black_monday_2 }
			swap_ideas = {
				remove_idea = TRK_black_monday_2
				add_idea = TRK_black_monday_3
			}
		}
		else_if = {
			limit = { has_idea = TRK_black_monday_1 }
			swap_ideas = {
				remove_idea = TRK_black_monday_1
				add_idea = TRK_black_monday_2
			}
		}
		else_if = {
			limit = { has_idea = TRK_black_monday }
			swap_ideas = {
				remove_idea = TRK_black_monday
				add_idea = TRK_black_monday_1
			}
		}
	}
}	
	
TRK_decrease_hegemony_nationalization = {
	if = {
		limit = { has_idea = TRK_russian_economic_hegemony_karaulbegi_embargo }
		swap_ideas = {
			remove_idea = TRK_russian_economic_hegemony_karaulbegi_embargo
			add_idea = TRK_russian_economic_hegemony_karaulbegi_embargo_nationaliation
		}
	}
	else_if = {
		limit = { has_idea = TRK_russian_economic_hegemony_karaulbegi }
		swap_ideas = {
			remove_idea = TRK_russian_economic_hegemony_karaulbegi
			add_idea = TRK_russian_economic_hegemony_karaulbegi_nationalization
		}
	}
	else_if = {
		limit = { has_idea = TRK_russian_economic_hegemony_1_taxes }
		swap_ideas = {
			remove_idea = TRK_russian_economic_hegemony_1_taxes
			add_idea = TRK_russian_economic_hegemony_1_taxes_nationalization
		}
	}
	else_if = {
		limit = { has_idea = TRK_russian_economic_hegemony_1 }
		swap_ideas = {
			remove_idea = TRK_russian_economic_hegemony_1
			add_idea = TRK_russian_economic_hegemony_1_nationalization
		}
	}
}
TRK_decrease_hegemony_taxes = {
	if = {
		limit = { has_idea = TRK_russian_economic_hegemony_1_taxes }
		swap_ideas = {
			remove_idea = TRK_russian_economic_hegemony_1_taxes
			add_idea = TRK_russian_economic_hegemony_2_taxes
		}
	}
	else_if = {
		limit = { has_idea = TRK_russian_economic_hegemony_1_taxes_nationalization }
		swap_ideas = {
			remove_idea = TRK_russian_economic_hegemony_1_taxes_nationalization
			add_idea = TRK_russian_economic_hegemony_2_taxes_nationalization
		}
	}
	else_if = {
		limit = { has_idea = TRK_russian_economic_hegemony_1 }
		swap_ideas = {
			remove_idea = TRK_russian_economic_hegemony_1
			add_idea = TRK_russian_economic_hegemony_1_taxes
		}
	}
	else_if = {
		limit = { has_idea = TRK_russian_economic_hegemony_karaulbegi }
		swap_ideas = {
			remove_idea = TRK_russian_economic_hegemony_karaulbegi
			add_idea = TRK_russian_economic_hegemony_karaulbegi_taxes
		}
	}
	else_if = {
		limit = { has_idea = TRK_russian_economic_hegemony_karaulbegi_nationalization }
		swap_ideas = {
			remove_idea = TRK_russian_economic_hegemony_karaulbegi_nationalization
			add_idea = TRK_russian_economic_hegemony_karaulbegi_taxes_nationalization
		}
	}
}
TRK_remove_british_mission = {
	clr_country_flag = TRK_british_military_mission
	every_other_country = {
		limit = {
			OR = {
				tag = ENT
				tag = AFG
				tag = DEH
			}
		}
		diplomatic_relation = {
			country = CAN
			relation = non_aggression_pact
			active = no
		}
		diplomatic_relation = {
			country = CAN
			relation = military_access
			active = no
		}
		remove_opinion_modifier = {
			target = TRK
			modifier = TRK_british_mission
		}
	}
	remove_opinion_modifier = {
		target = ENT
		modifier = TRK_british_mission
	}
	remove_opinion_modifier = {
		target = DEH
		modifier = TRK_british_mission
	}
	random_unit_leader = {
		limit = { has_id = 65899 }
		set_nationality = DEH
	}
}
TRK_remove_russian_economic_hegemony = {
	effect_tooltip = { remove_ideas = TRK_russian_economic_hegemony }
	hidden_effect = {
		remove_ideas = {
			TRK_russian_economic_hegemony
			TRK_russian_economic_hegemony_1
			TRK_russian_economic_hegemony_1_taxes
			TRK_russian_economic_hegemony_2_taxes
			TRK_russian_economic_hegemony_1_taxes_nationalization
			TRK_russian_economic_hegemony_2_taxes_nationalization
			TRK_russian_economic_hegemony_1_nationalization
			TRK_russian_economic_hegemony_karaulbegi
			TRK_russian_economic_hegemony_karaulbegi_nationalization
			TRK_russian_economic_hegemony_karaulbegi_taxes
			TRK_russian_economic_hegemony_karaulbegi_taxes_nationalization
			TRK_russian_economic_hegemony_karaulbegi_embargo
			TRK_russian_economic_hegemony_karaulbegi_embargo_nationaliation
		}
		if = {
			limit = {
				AFG = {
					is_subject = yes
					custom_trigger_tooltip = {
						has_country_flag = DEH_subjugate_afghans
						tooltip = AFG_subjugated_by_DEH
					}
				}
			}
			DEH = {
				country_event = {
					id = bukhara.63
					days = 2
				}
			}
		}
	}
}
TRK_remove_stagnant_government_bureaucracy = {
	effect_tooltip = { remove_ideas = TRK_stagnant_government_bureaucracy }
	hidden_effect = {
		remove_ideas = {
			TRK_stagnant_government_bureaucracy
			TRK_stagnant_government_bureaucracy_1
			TRK_stagnant_government_bureaucracy_2
			TRK_stagnant_government_bureaucracy_3
			TRK_stagnant_government_bureaucracy_4
		}
	}
}
TRK_improve_bureaucracy = {
	if = {
		limit = { has_idea = TRK_stagnant_government_bureaucracy_4 }
		remove_ideas = TRK_stagnant_government_bureaucracy_4
	}
	else_if = {
		limit = { has_idea = TRK_stagnant_government_bureaucracy_3 }
		swap_ideas = {
			remove_idea = TRK_stagnant_government_bureaucracy_3
			add_idea = TRK_stagnant_government_bureaucracy_4
		}
	}
	else_if = {
		limit = { has_idea = TRK_stagnant_government_bureaucracy_2 }
		swap_ideas = {
			remove_idea = TRK_stagnant_government_bureaucracy_2
			add_idea = TRK_stagnant_government_bureaucracy_3
		}
	}
	else_if = {
		limit = { has_idea = TRK_stagnant_government_bureaucracy_1 }
		swap_ideas = {
			remove_idea = TRK_stagnant_government_bureaucracy_1
			add_idea = TRK_stagnant_government_bureaucracy_2
		}
	}
	else_if = {
		limit = { has_idea = TRK_stagnant_government_bureaucracy }
		swap_ideas = {
			remove_idea = TRK_stagnant_government_bureaucracy
			add_idea = TRK_stagnant_government_bureaucracy_1
		}
	}
}
TRK_remove_monarchist_ideas = {
	if = {
		limit = { has_idea = TRK_legacy_of_emir }
		remove_ideas = TRK_legacy_of_emir
	}
	if = {
		limit = { has_idea = TRK_legacy_of_emir_kushbegi }
		remove_ideas = TRK_legacy_of_emir_kushbegi
	}
	if = {
		limit = { has_idea = TRK_legacy_of_emir_karaulbegi }
		remove_ideas = TRK_legacy_of_emir_karaulbegi
	}
	if = {
		limit = { has_idea = TRK_minorities_persecuted }
		remove_ideas = TRK_minorities_persecuted
	}
	if = {
		limit = { has_idea = TRK_central_asian_mecca }
		remove_ideas = TRK_central_asian_mecca
	}
	if = {
		limit = { TRK_has_stagnant_government_bureaucracy = yes }
		TRK_remove_stagnant_government_bureaucracy = yes
	}		
}