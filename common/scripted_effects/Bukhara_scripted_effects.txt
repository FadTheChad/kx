UZB_change_centralisation = {
	if = {
		limit = { 
			has_country_flag = UZB_centralisation_of_emirate
			UZB_alim_khan_in_power = yes 
		}
		# convert percent to absolute
		if = {
			limit = {
				check_variable = { UZB_centralisation_change > -1 }
				check_variable = { UZB_centralisation_change < 1 }
			}
			multiply_temp_variable = { UZB_centralisation_change = 100 }
		}

		# tooltip
		effect_tooltip = {
			add_to_variable = {
				UZB_centralisation = UZB_centralisation_change
				tooltip = UZB_centralisation_tooltip
			}
		}

		# lower limit = legitimacy * -1
		set_temp_variable = { UZB_lower_limit = UZB_centralisation }
		multiply_temp_variable = { UZB_lower_limit = -1 }

		# upper limit = 100 - legitimacy
		set_temp_variable = { UZB_upper_limit = 100 }
		subtract_from_temp_variable = { UZB_upper_limit = UZB_centralisation }

		# avoid values outside the allowed range
		clamp_temp_variable = {
			var = UZB_centralisation_change
			min = UZB_lower_limit
			max = UZB_upper_limit
		}

		# add the variable
		add_to_variable = { UZB_centralisation = UZB_centralisation_change }
	}
}
UZB_change_decentralisation = {
	if = {
		limit = { 
			has_country_flag = UZB_decentralisation_of_emirate
			UZB_alim_khan_in_power = yes 
		}
		# convert percent to absolute
		if = {
			limit = {
				check_variable = { UZB_decentralisation_change > -1 }
				check_variable = { UZB_decentralisation_change < 1 }
			}
			multiply_temp_variable = { UZB_decentralisation_change = 100 }
		}

		# tooltip
		effect_tooltip = {
			add_to_variable = {
				UZB_decentralisation = UZB_decentralisation_change
				tooltip = UZB_decentralisation_tooltip
			}
		}

		# lower limit = legitimacy * -1
		set_temp_variable = { UZB_lower_limit = UZB_decentralisation }
		multiply_temp_variable = { UZB_lower_limit = -1 }

		# upper limit = 100 - legitimacy
		set_temp_variable = { UZB_upper_limit = 100 }
		subtract_from_temp_variable = { UZB_upper_limit = UZB_decentralisation }

		# avoid values outside the allowed range
		clamp_temp_variable = {
			var = UZB_decentralisation_change
			min = UZB_lower_limit
			max = UZB_upper_limit
		}

		# add the variable
		add_to_variable = { UZB_decentralisation = UZB_decentralisation_change }
	}
}
UZB_increase_kushbegi = {
	custom_effect_tooltip = UZB_increase_kushbegi
	add_to_variable = { UZB_kushbegi = 1 }
	add_to_variable = { UZB_karaulbegi = -1 }
}
UZB_increase_karaulbegi = {
	custom_effect_tooltip = UZB_increase_karaulbegi
	add_to_variable = { UZB_karaulbegi = 1 }
	add_to_variable = { UZB_kushbegi = -1 }
}
UZB_decrease_kushbegi = {
	custom_effect_tooltip = UZB_decrease_kushbegi
	add_to_variable = { UZB_kushbegi = -1 }
	add_to_variable = { UZB_karaulbegi = 1 }
}
UZB_decrease_karaulbegi = {
	custom_effect_tooltip = UZB_decrease_karaulbegi
	add_to_variable = { UZB_karaulbegi = -1 }
	add_to_variable = { UZB_kushbegi = 1 }
}
UZB_increase_reformists = {
	if = {
		limit = {
			NOT = { has_country_flag = UZB_antireformist_coup }
		}
		custom_effect_tooltip = UZB_increase_reformists
		add_to_variable = { UZB_reformists = 1 }
	}
}
UZB_decrease_reformists = {
	if = {
		limit = {
			NOT = { has_country_flag = UZB_antireformist_coup }
		}
		custom_effect_tooltip = UZB_decrease_reformists
		add_to_variable = { UZB_reformists = -1 }
	}
}
UZB_closer_to_chaos = {
	if = {
		limit = {
			UZB_alim_khan_in_power = yes
		}
		if = {
			limit = {
				check_variable = { UZB_chaos > 3 }
			}
			custom_effect_tooltip = UZB_closer_to_chaos_yellow
			add_to_variable = { UZB_chaos = -1 }
		}
		else_if = {
			limit = {
				check_variable = { UZB_chaos < 4 }
				check_variable = { UZB_chaos > 1 }
			}
			custom_effect_tooltip = UZB_closer_to_chaos_red
			add_to_variable = { UZB_chaos = -1 }
		}
		else = {
			custom_effect_tooltip = UZB_closer_to_chaos_dead
			add_to_variable = { UZB_chaos = -1 }
			if = {
				limit = {
					has_country_flag = UZB_young_bukhara_radical
					OR = {
						is_ai = no
						AND = {
							is_ai = yes
							NOT = {
								has_game_rule = {
									rule = UZB_PATH
									option = UZB_PATH_ABS_MON
								}
								has_game_rule = {
									rule = UZB_PATH
									option = UZB_PATH_ABS_MON_IBRAHIM
								}
							}
						}
					}
				}
				hidden_effect = {
					country_event = {
						id = bukhara.50
						days = 2
					}
				}
			}
			else_if = {
				limit = {
					OR = {
						is_ai = no
						AND = {
							is_ai = yes
							NOT = {
								has_game_rule = {
									rule = UZB_PATH
									option = UZB_PATH_ABS_MON
								}
								has_game_rule = {
									rule = UZB_PATH
									option = UZB_PATH_ABS_MON_IBRAHIM
								}
							}
						}
					}
				}
				hidden_effect = {
					country_event = {
						id = bukhara.15
						days = 2
					}
				}
			}
		}
	}
}

UZB_decrease_largest_begi = {
	if = {
		limit = { 
			check_variable = { UZB_karaulbegi > UZB_kushbegi }
		}
		UZB_decrease_karaulbegi = yes
	}
	else = {
		UZB_decrease_kushbegi = yes
	}
}
UZB_decrease_black_monday = {
	custom_effect_tooltip = UZB_decrease_black_monday
	hidden_effect = {
		if = {
			limit = { has_idea = UZB_black_monday_4 }
			remove_ideas = UZB_black_monday_4
			add_timed_idea = {
				idea = UZB_black_monday_5
				days = 365
			}
		}
		else_if = {
			limit = { has_idea = UZB_black_monday_3 }
			swap_ideas = {
				remove_idea = UZB_black_monday_3
				add_idea = UZB_black_monday_4
			}
		}
		else_if = {
			limit = { has_idea = UZB_black_monday_2 }
			swap_ideas = {
				remove_idea = UZB_black_monday_2
				add_idea = UZB_black_monday_3
			}
		}
		else_if = {
			limit = { has_idea = UZB_black_monday_1 }
			swap_ideas = {
				remove_idea = UZB_black_monday_1
				add_idea = UZB_black_monday_2
			}
		}
		else_if = {
			limit = { has_idea = UZB_black_monday }
			swap_ideas = {
				remove_idea = UZB_black_monday
				add_idea = UZB_black_monday_1
			}
		}
	}
}	
	
UZB_decrease_hegemony_nationalization = {
	if = {
		limit = { has_idea = UZB_russian_economic_hegemony_karaulbegi_embargo }
		swap_ideas = {
			remove_idea = UZB_russian_economic_hegemony_karaulbegi_embargo
			add_idea = UZB_russian_economic_hegemony_karaulbegi_embargo_nationaliation
		}
	}
	else_if = {
		limit = { has_idea = UZB_russian_economic_hegemony_karaulbegi }
		swap_ideas = {
			remove_idea = UZB_russian_economic_hegemony_karaulbegi
			add_idea = UZB_russian_economic_hegemony_karaulbegi_nationalization
		}
	}
	else_if = {
		limit = { has_idea = UZB_russian_economic_hegemony_1_taxes }
		swap_ideas = {
			remove_idea = UZB_russian_economic_hegemony_1_taxes
			add_idea = UZB_russian_economic_hegemony_1_taxes_nationalization
		}
	}
	else_if = {
		limit = { has_idea = UZB_russian_economic_hegemony_1 }
		swap_ideas = {
			remove_idea = UZB_russian_economic_hegemony_1
			add_idea = UZB_russian_economic_hegemony_1_nationalization
		}
	}
}
UZB_decrease_hegemony_taxes = {
	if = {
		limit = { has_idea = UZB_russian_economic_hegemony_1_taxes }
		swap_ideas = {
			remove_idea = UZB_russian_economic_hegemony_1_taxes
			add_idea = UZB_russian_economic_hegemony_2_taxes
		}
	}
	else_if = {
		limit = { has_idea = UZB_russian_economic_hegemony_1_taxes_nationalization }
		swap_ideas = {
			remove_idea = UZB_russian_economic_hegemony_1_taxes_nationalization
			add_idea = UZB_russian_economic_hegemony_2_taxes_nationalization
		}
	}
	else_if = {
		limit = { has_idea = UZB_russian_economic_hegemony_1 }
		swap_ideas = {
			remove_idea = UZB_russian_economic_hegemony_1
			add_idea = UZB_russian_economic_hegemony_1_taxes
		}
	}
	else_if = {
		limit = { has_idea = UZB_russian_economic_hegemony_karaulbegi }
		swap_ideas = {
			remove_idea = UZB_russian_economic_hegemony_karaulbegi
			add_idea = UZB_russian_economic_hegemony_karaulbegi_taxes
		}
	}
	else_if = {
		limit = { has_idea = UZB_russian_economic_hegemony_karaulbegi_nationalization }
		swap_ideas = {
			remove_idea = UZB_russian_economic_hegemony_karaulbegi_nationalization
			add_idea = UZB_russian_economic_hegemony_karaulbegi_taxes_nationalization
		}
	}
}
UZB_remove_british_mission = {
	clr_country_flag = UZB_british_military_mission
	every_other_country = {
		limit = {
			OR = {
				tag = ENT
				tag = AFG
				tag = DEH
			}
		}
		diplomatic_relation = {
			country = CAN
			relation = non_aggression_pact
			active = no
		}
		diplomatic_relation = {
			country = CAN
			relation = military_access
			active = no
		}
		remove_opinion_modifier = {
			target = UZB
			modifier = UZB_british_mission
		}
	}
	remove_opinion_modifier = {
		target = ENT
		modifier = UZB_british_mission
	}
	remove_opinion_modifier = {
		target = DEH
		modifier = UZB_british_mission
	}
	random_unit_leader = {
		limit = { has_id = 65899 }
		set_nationality = DEH
	}
}
UZB_remove_russian_economic_hegemony = {
	effect_tooltip = { remove_ideas = UZB_russian_economic_hegemony }
	hidden_effect = {
		remove_ideas = {
			UZB_russian_economic_hegemony
			UZB_russian_economic_hegemony_1
			UZB_russian_economic_hegemony_1_taxes
			UZB_russian_economic_hegemony_2_taxes
			UZB_russian_economic_hegemony_1_taxes_nationalization
			UZB_russian_economic_hegemony_2_taxes_nationalization
			UZB_russian_economic_hegemony_1_nationalization
			UZB_russian_economic_hegemony_karaulbegi
			UZB_russian_economic_hegemony_karaulbegi_nationalization
			UZB_russian_economic_hegemony_karaulbegi_taxes
			UZB_russian_economic_hegemony_karaulbegi_taxes_nationalization
			UZB_russian_economic_hegemony_karaulbegi_embargo
			UZB_russian_economic_hegemony_karaulbegi_embargo_nationaliation
		}
		if = {
			limit = {
				AFG = {
					is_subject = yes
					custom_trigger_tooltip = {
						has_country_flag = DEH_subjugate_afghans
						tooltip = AFG_subjugated_by_DEH
					}
				}
			}
			DEH = {
				country_event = {
					id = bukhara.63
					days = 2
				}
			}
		}
	}
}
UZB_remove_stagnant_government_bureaucracy = {
	effect_tooltip = { remove_ideas = UZB_stagnant_government_bureaucracy }
	hidden_effect = {
		remove_ideas = {
			UZB_stagnant_government_bureaucracy
			UZB_stagnant_government_bureaucracy_1
			UZB_stagnant_government_bureaucracy_2
			UZB_stagnant_government_bureaucracy_3
			UZB_stagnant_government_bureaucracy_4
		}
	}
}
UZB_improve_bureaucracy = {
	if = {
		limit = { has_idea = UZB_stagnant_government_bureaucracy_2 }
		remove_ideas = UZB_stagnant_government_bureaucracy_2
	}
	else_if = {
		limit = { has_idea = UZB_stagnant_government_bureaucracy_1 }
		swap_ideas = {
			remove_idea = UZB_stagnant_government_bureaucracy_1
			add_idea = UZB_stagnant_government_bureaucracy_2
		}
	}
	else_if = {
		limit = { has_idea = UZB_stagnant_government_bureaucracy }
		swap_ideas = {
			remove_idea = UZB_stagnant_government_bureaucracy
			add_idea = UZB_stagnant_government_bureaucracy_1
		}
	}
}
UZB_remove_monarchist_ideas = {
	if = {
		limit = { has_idea = UZB_legacy_of_emir }
		remove_ideas = UZB_legacy_of_emir
	}
	if = {
		limit = { has_idea = UZB_legacy_of_emir_kushbegi }
		remove_ideas = UZB_legacy_of_emir_kushbegi
	}
	if = {
		limit = { has_idea = UZB_legacy_of_emir_karaulbegi }
		remove_ideas = UZB_legacy_of_emir_karaulbegi
	}
	if = {
		limit = { has_idea = UZB_minorities_persecuted }
		remove_ideas = UZB_minorities_persecuted
	}
	if = {
		limit = { has_idea = UZB_central_asian_mecca }
		remove_ideas = UZB_central_asian_mecca
	}
	if = {
		limit = { UZB_has_stagnant_government_bureaucracy = yes }
		UZB_remove_stagnant_government_bureaucracy = yes
	}		
}