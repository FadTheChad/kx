turkestan_puppet_ROOT_effect = {
	hidden_effect = {
		set_temp_variable = { new_overlord = THIS }
		ROOT = {
			get_current_government_type = yes
			every_subject_country = {
				get_current_government_type = yes
				if = {
					limit = { is_central_asian_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_governorate
							end_wars = no
						}
					}
				}
				else = {
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_default_puppet
							end_wars = no
						}
					}
				}
				restore_previous_government_type = yes
			}
		}
	}
	set_autonomy = {
		target = ROOT
		autonomy_state = kr_governorate
		end_wars = no
	}
	hidden_effect = {
		if = {
			limit = { has_wargoal_against = ROOT }
			remove_wargoal = { target = ROOT type = all }
		}
		ROOT = {
			restore_previous_government_type = yes
			turkestan_clear_potential_national_government = yes
			every_owned_state = {
				limit = { is_central_asia = yes }
				remove_claim_by = PREV
			}
			if = {
				limit = { has_wargoal_against = PREV }
				remove_wargoal = { target = PREV type = all }
			}
		}
	}
}
turkestan_puppet_FROM_effect = {
	hidden_effect = {
		set_temp_variable = { new_overlord = THIS }
		FROM = {
			every_subject_country = {
				get_current_government_type = yes
				if = {
					limit = { is_central_asian_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_governorate
							end_wars = no
						}
					}
				}
				else = {
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_default_puppet
							end_wars = no
						}
					}
				}
				restore_previous_government_type = yes
			}
			get_current_government_type = yes
		}
	}
	set_autonomy = {
		target = FROM
		autonomy_state = kr_governorate
		end_wars = no
	}
	hidden_effect = {
		FROM = {
			restore_previous_government_type = yes
			turkestan_clear_potential_national_government = yes
			every_owned_state = {
				limit = { is_central_asia = yes }
				remove_claim_by = PREV.PREV
			}
		}
	}
}

turkestan_puppet_TARGET_effect = {
	hidden_effect = { var:target = { get_current_government_type = yes } }
	set_autonomy = {
		target = var:target
		autonomy_state = kr_governorate
		end_wars = no
	}
	hidden_effect = {
		var:target = {
			restore_previous_government_type = yes
			turkestan_clear_potential_national_government = yes
			every_owned_state = {
				limit = { is_core_china = yes }
				remove_claim_by = PREV.PREV
			}
		}
	}
}

turkestan_integrate_ally_effect = {
	transfer_all_unit_leaders_to_FROM = yes
	every_subject_country = {
		get_current_government_type = yes
		FROM = {
			set_autonomy = {
				target = PREV
				autonomy_state = kr_integrated_puppet
				end_wars = no
			}
		}
		restore_previous_government_type = yes
	}
	every_owned_state = {
		limit = {
			is_central_asia = yes
			is_claim_or_core_of_FROM = no
		}
		add_claim_by = FROM
	}
	FROM = {
		annex_country = {
			target = ROOT
			transfer_troops = yes
		}
	}
	if = {
		limit = { is_ai = no }
		FROM = { change_tag_from = ROOT }
	}
}

turkestan_integrate_TARGET_effect = {
	set_temp_variable = { integrator = THIS }
	var:target = {
		every_unit_leader = {
			hidden_effect = {
				if = {
					limit = { is_field_marshal = yes }
					demote_leader = yes
				}
				remove_trait = { trait = recently_promoted }
			}
			set_nationality = var:integrator
		}
		every_subject_country = {
			custom_effect_tooltip = tooltip_white_line
			get_current_government_type = yes
			var:integrator = { puppet = PREV }
			restore_previous_government_type = yes
		}
		custom_effect_tooltip = tooltip_white_line
		every_core_state = {
			limit = {
				is_central_asia = yes
				NOT = { is_core_of = var:integrator }
			}
			add_claim_by = var:integrator
		}
	}
}
turkestan_set_potential_national_government = {
	if = {
		limit = {
			NOT = { has_country_flag = turkestan_is_potential_government }
		}
		set_country_flag = turkestan_is_potential_government
		every_state = {
			limit = {
				is_central_asia = yes
				NOT = {
					has_variable = ambition_area_@PREV
				}
			}
			add_to_array = { PREV.turkestan_government_ambitions = THIS }
			set_variable = { ambition_area_@PREV = 1 }
		}
		every_other_country = {
			limit = { is_turkestan_tag = yes }
			ROOT = { add_to_array = { turkestan_possible_allies_array = PREV } }
		}
	}	
}
turkestan_clear_potential_national_government = {
	hidden_effect = {
		clr_country_flag = turkestan_is_potential_government
		for_each_scope_loop = {
			array = turkestan_government_ambitions
			remove_claim_by = PREV
			clear_variable = ambition_area_@PREV
		}
		clear_array = turkestan_government_ambitions
		for_each_loop = {
			array = turkestan_possible_allies_array
			remove_targeted_decision = { decision = turkestan_offer_alliance target = var:v }
		}
		clear_array = turkestan_possible_allies_array
	}
}

turkestan_enable_all_demand_submission_decisions = {
	effect_tooltip = {
		if = {
			limit = { can_declare_war_on = TRK }
			activate_targeted_decision = { decision = turkestan_demand_submission target = TRK }
		}
		if = {
			limit = { can_declare_war_on = UZB }
			activate_targeted_decision = { decision = turkestan_demand_submission target = UZB }
		}
		if = {
			limit = { can_declare_war_on = KHI }
			activate_targeted_decision = { decision = turkestan_demand_submission target = KHI }
		}
		if = {
			limit = { can_declare_war_on = ALO }
			activate_targeted_decision = { decision = turkestan_demand_submission target = ALO }
		}
		if = {
			limit = { can_declare_war_on = KYR }
			activate_targeted_decision = { decision = turkestan_demand_submission target = KYR }
		}
		if = {
			limit = { can_declare_war_on = TAJ }
			activate_targeted_decision = { decision = turkestan_demand_submission target = TAJ }
		}
		if = {
			limit = { can_declare_war_on = ORE }
			activate_targeted_decision = { decision = turkestan_demand_submission target = ORE }
		}
	}
	hidden_effect = {
		every_other_country = {
			limit = {
				is_central_asian_tag = yes
			}
			add_to_array = { ROOT.turkestan_possible_targets_array = THIS }
		}
	}
}
turkestan_recheck_alignment_if_puppet = {
	if = {
		limit = { china_is_governorate = yes }
		if = {
			limit = {
				overlord = { turkestan_compatible_alignment_to_PREV = no }
			}
			overlord = {
				set_autonomy = {
					target = ROOT
					autonomy_state = autonomy_free
				}
			}			
		}
	}
}
