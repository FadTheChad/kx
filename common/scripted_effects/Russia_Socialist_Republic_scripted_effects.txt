### SOVNARKOM ###
SOV_setup_politburo = {
	# add_to_array = { Politburo_Leader_Identity= <d> }	# Leader ID
	# add_to_array = { Politburo_Leader_Faction = <d> }	# 0 for independent, 1 for bukharin, 2 for rykov, 3 for workers opposition, 4 for old guard, 5 for left communists, 6 for hardliners
	# add_to_array = { Politburo_Leader_Authority= <d> }	# authority variable
	# add_to_array = { Politburo_Leader_status = <d> } # 0 for sit-out, 1 for in Politburo, 2 Leader
	#
	# NULL #
	add_to_array = { Politburo_Leader_Identity		= 1		}
	add_to_array = { Politburo_Leader_Faction		= 0		}
	add_to_array = { Politburo_Leader_Authority		= 0		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	# Bukharin #
	add_to_array = { Politburo_Leader_Identity		= 2		}
	add_to_array = { Politburo_Leader_Faction		= 1		}
	add_to_array = { Politburo_Leader_Authority		= 10	}
	add_to_array = { Politburo_Leader_Status		= 2		}
	# Rykov #
	add_to_array = { Politburo_Leader_Identity		= 3		}
	add_to_array = { Politburo_Leader_Faction		= 1		}
	add_to_array = { Politburo_Leader_Authority		= 8		}
	add_to_array = { Politburo_Leader_Status		= 1		}
	# Shlyapnikov #
	add_to_array = { Politburo_Leader_Identity		= token:RUS_Aleksandr_Shlyapnikov_hog_syn }
	add_to_array = { Politburo_Leader_Faction		= 1		}
	add_to_array = { Politburo_Leader_Authority		= 5		}
	add_to_array = { Politburo_Leader_Status		= 1		}
	# Tomsky #
	add_to_array = { Politburo_Leader_Identity		= 5		}
	add_to_array = { Politburo_Leader_Faction		= 1		}
	add_to_array = { Politburo_Leader_Authority		= 4		}
	add_to_array = { Politburo_Leader_Status		= 1		}
	# Kollontai #
	add_to_array = { Politburo_Leader_Identity		= 6		}
	add_to_array = { Politburo_Leader_Faction		= 1		}
	add_to_array = { Politburo_Leader_Authority		= 5		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	# Kamenev #
	add_to_array = { Politburo_Leader_Identity		= 7		}
	add_to_array = { Politburo_Leader_Faction		= 1		}
	add_to_array = { Politburo_Leader_Authority		= 4		}
	add_to_array = { Politburo_Leader_Status		= 1		}
	# Sokolnikov #
	add_to_array = { Politburo_Leader_Identity		= 8		}
	add_to_array = { Politburo_Leader_Faction		= 1		}
	add_to_array = { Politburo_Leader_Authority		= 3		}
	add_to_array = { Politburo_Leader_Status		= 1		}
	# Kirov #
	add_to_array = { Politburo_Leader_Identity		= 9		}
	add_to_array = { Politburo_Leader_Faction		= 1		}
	add_to_array = { Politburo_Leader_Authority		= 2		}
	add_to_array = { Politburo_Leader_Status		= 1		}
	# Zhdanov #
	add_to_array = { Politburo_Leader_Identity		= 10	}
	add_to_array = { Politburo_Leader_Faction		= 2		}
	add_to_array = { Politburo_Leader_Authority		= 1		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	# Kuznetsov #
	add_to_array = { Politburo_Leader_Identity		= 11	}
	add_to_array = { Politburo_Leader_Faction		= 3		}
	add_to_array = { Politburo_Leader_Authority		= 1		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	# Kosygin #
	add_to_array = { Politburo_Leader_Identity		= 12	}
	add_to_array = { Politburo_Leader_Faction		= 1		}
	add_to_array = { Politburo_Leader_Authority		= 1		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	# Ryutin #
	add_to_array = { Politburo_Leader_Identity		= 13	}
	add_to_array = { Politburo_Leader_Faction		= 1		}
	add_to_array = { Politburo_Leader_Authority		= 2		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	# Lunacharsky #
	add_to_array = { Politburo_Leader_Identity		= 14	}
	add_to_array = { Politburo_Leader_Faction		= 4		}
	add_to_array = { Politburo_Leader_Authority		= 2		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	# Bogdanov #
	add_to_array = { Politburo_Leader_Identity		= 15	}
	add_to_array = { Politburo_Leader_Faction		= 4		}
	add_to_array = { Politburo_Leader_Authority		= 5		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	# Gastev #
	add_to_array = { Politburo_Leader_Identity		= 16	}
	add_to_array = { Politburo_Leader_Faction		= 3		}
	add_to_array = { Politburo_Leader_Authority		= 1		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	# Mayakovsky #
	add_to_array = { Politburo_Leader_Identity		= 17	}
	add_to_array = { Politburo_Leader_Faction		= 6		}
	add_to_array = { Politburo_Leader_Authority		= 2		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	# Zinoviev #
	add_to_array = { Politburo_Leader_Identity		= 18	}
	add_to_array = { Politburo_Leader_Faction		= 5		}
	add_to_array = { Politburo_Leader_Authority		= 6		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	# Blagonravov #
	add_to_array = { Politburo_Leader_Identity		= 19	}
	add_to_array = { Politburo_Leader_Faction		= 5		}
	add_to_array = { Politburo_Leader_Authority		= 2		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	# Yagoda #
	add_to_array = { Politburo_Leader_Identity		= 20	}
	add_to_array = { Politburo_Leader_Faction		= 6		}
	add_to_array = { Politburo_Leader_Authority		= 1		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	# Yezhov #
	add_to_array = { Politburo_Leader_Identity		= 21	}
	add_to_array = { Politburo_Leader_Faction		= 6		}
	add_to_array = { Politburo_Leader_Authority		= 0		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	# Krestinsky #
	add_to_array = { Politburo_Leader_Identity		= 22	}
	add_to_array = { Politburo_Leader_Faction		= 6		}
	add_to_array = { Politburo_Leader_Authority		= 6		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	# Molotov #
	add_to_array = { Politburo_Leader_Identity		= 23	}
	add_to_array = { Politburo_Leader_Faction		= 6		}
	add_to_array = { Politburo_Leader_Authority		= 6		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	# Kaganovich #
	add_to_array = { Politburo_Leader_Identity		= 24	}
	add_to_array = { Politburo_Leader_Faction		= 6		}
	add_to_array = { Politburo_Leader_Authority		= 1		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	
	set_country_flag = SOV_politburo_active
	SOV_calculate_politburo_factions = yes
	
}
SOV_calculate_politburo_factions = {
	set_variable = { Politburo_Bukharin_Faction = 0 }
	set_variable = { Politburo_Rykov_Faction = 0 }
	set_variable = { Politburo_WorkersOpposition_Faction = 0 }
	set_variable = { Politburo_OldGuard_Faction = 0 }
	set_variable = { Politburo_Centre_Faction = 0 }
	set_variable = { Politburo_Hardliner_Faction = 0 }
	
	for_each_loop = {
		array = Politburo_Leader_Faction
		value = value
		index = i
		
		if = {
			limit = { check_variable = { Politburo_Leader_Status^i > 0 } }
			if = {
				limit = { check_variable = { Politburo_Leader_Faction^i = 1 } }
				add_to_variable = { Politburo_Bukharin_Faction_num = 1 }
				add_to_variable = { Politburo_Bukharin_Faction = Politburo_Leader_Authority^i }
			}
			else_if = {
				limit = { check_variable = { Politburo_Leader_Faction^i = 2 } }
				add_to_variable = { Politburo_Rykov_Faction_num = 1 }
				add_to_variable = { Politburo_Rykov_Faction = Politburo_Leader_Authority^i }
			}
			else_if = {
				limit = { check_variable = { Politburo_Leader_Faction^i = 3 } }
				add_to_variable = { Politburo_WorkersOpposition_Faction_num = 1 }
				add_to_variable = { Politburo_WorkersOpposition_Faction = Politburo_Leader_Authority^i }
			}
			else_if = {
				limit = { check_variable = { Politburo_Leader_Faction^i = 4 } }
				add_to_variable = { Politburo_OldGuard_Faction_num = 1 }
				add_to_variable = { Politburo_OldGuard_Faction = Politburo_Leader_Authority^i }
			}
			else_if = {
				limit = { check_variable = { Politburo_Leader_Faction^i = 5 } }
				add_to_variable = { Politburo_Centre_Faction_num = 1 }
				add_to_variable = { Politburo_Centre_Faction = Politburo_Leader_Authority^i }
			}
			else_if = {
				limit = { check_variable = { Politburo_Leader_Faction^i = 6 } }
				add_to_variable = { Politburo_Hardliner_Faction_num = 1 }
				add_to_variable = { Politburo_Hardliner_Faction = Politburo_Leader_Authority^i }
			}
		}
	}
	divide_variable = { Politburo_Bukharin_Faction = Politburo_Bukharin_Faction_num }
	divide_variable = { Politburo_Rykov_Faction = Politburo_Rykov_Faction_num }
	divide_variable = { Politburo_WorkersOpposition_Faction = Politburo_WorkersOpposition_Faction_num }
	divide_variable = { Politburo_OldGuard_Faction = Politburo_OldGuard_Faction_num }
	divide_variable = { Politburo_Centre_Faction = Politburo_Centre_Faction_num }
	divide_variable = { Politburo_Hardliner_Faction = Politburo_Hardliner_Faction_num }
}
SOV_politburo_change_authority = {
	if = {
		limit = {
			NOT = { check_variable = { Politburo_Leader_Identity^Politburo_Leader_Name = 0 } }
		}
		# tooltip
		effect_tooltip = {
			add_to_variable = {
				Politburo_Leader_Authority^Politburo_Leader_Name = politburo_var_change
				tooltip = SOV_politburo_change_authority_tooltip
			}
		}

		# lower limit = influence * -1
		set_temp_variable = { SOV_lower_limit = Politburo_Leader_Authority^Politburo_Leader_Name }
		multiply_temp_variable = { SOV_lower_limit = -1 }

		# avoid values outside the allowed range
		clamp_temp_variable = {
			var = politburo_var_change
			min = SOV_lower_limit
			max = 10
		}

		# add the variable
		add_to_variable = { Politburo_Leader_Authority^Politburo_Leader_Name = politburo_var_change }
		SOV_calculate_politburo_factions = yes
	}
}
SOV_setup_soviet_congress = {
	set_country_flag = SOV_congress_ongoing
	activate_targeted_decision = { target = ROOT decision = SOV_question_of_the_trade_unions }
	activate_targeted_decision = { target = ROOT decision = SOV_question_of_autonomies }
	if = {
		limit = { has_global_flag = RUS_land_reform_finished }
		set_country_flag = SOV_question_of_land_completed
	}
	else = {
		activate_targeted_decision = { target = ROOT decision = SOV_question_of_land }
	}
	activate_targeted_decision = { target = ROOT decision = SOV_question_of_constitution }
	activate_targeted_decision = { target = ROOT decision = SOV_question_of_banks_trade }
	activate_targeted_decision = { target = ROOT decision = SOV_question_of_labor_conscription }
	
	set_variable = { SOV_soviet_constitution_political_power_factor = 0.05 }
	if = {
		limit = { 
			NOT = { has_country_flag = psr_banned }
		}
		set_variable = { sov_congress_plsr_seats = ROOT.party_popularity@syndicalist }
		multiply_variable = { sov_congress_plsr_seats = 2 }
		divide_variable = { sov_congress_plsr_seats = 3 }
		set_variable = { sov_congress_psr_seats = ROOT.party_popularity@syndicalist }
		divide_variable = { sov_congress_psr_seats = 3 }
		set_variable = { sov_congress_nsp_seats = ROOT.party_popularity@radical_socialist }
		multiply_variable = { sov_congress_nsp_seats = 2 }
		divide_variable = { sov_congress_nsp_seats = 3 }
		set_temp_variable = { sov_congress_psr_radsoc_fraction = ROOT.party_popularity@radical_socialist }
		divide_temp_variable = { sov_congress_psr_radsoc_fraction = 3 }
		add_to_variable = { sov_congress_psr_seats = sov_congress_psr_radsoc_fraction }
	}
	else = {
		set_variable = { sov_congress_plsr_seats = ROOT.party_popularity@syndicalist }
		set_variable = { sov_congress_nsp_seats = ROOT.party_popularity@radical_socialist }
	}
	set_variable = { sov_congress_rsdrp_seats = ROOT.party_popularity@social_democrat }
	
	add_to_variable = { sov_congress_sum = sov_congress_plsr_seats }
	add_to_variable = { sov_congress_sum = sov_congress_psr_seats }
	add_to_variable = { sov_congress_sum = sov_congress_nsp_seats }
	add_to_variable = { sov_congress_sum = sov_congress_rsdrp_seats }
	set_variable = { sov_congress_sum_1 = 1 }
	subtract_from_variable = { sov_congress_sum_1 = sov_congress_sum }
	if = {
		limit = { 
			NOT = { has_country_flag = psr_banned }
		}
		set_temp_variable = { divider = 4 }
		divide_variable = { sov_congress_sum_1 = divider }
		add_to_variable = { sov_congress_psr_seats = sov_congress_sum_1 }
	}
	else = {
		set_temp_variable = { divider = 3 }
		divide_variable = { sov_congress_sum_1 = divider }
	}
	add_to_variable = { sov_congress_plsr_seats = sov_congress_sum_1 }
	add_to_variable = { sov_congress_nsp_seats = sov_congress_sum_1 }
	add_to_variable = { sov_congress_rsdrp_seats = sov_congress_sum_1 }	
}
SOV_soviet_congress_increase_rkp = {
	if = {
		limit = { 
			NOT = { has_country_flag = rkp_banned }
		}
		custom_effect_tooltip = SOV_soviet_congress_increase_rkp
		add_popularity = { ideology = totalist popularity = 0.05 }
		set_temp_variable = { sov_congress_seats_change = 0.05 }
		add_to_variable = { sov_congress_rkp_seats = sov_congress_seats_change }
		if = {
			limit = { 
				NOT = { has_country_flag = psr_banned }
			}
			set_temp_variable = { divider = -4 }
			divide_temp_variable = { sov_congress_seats_change = divider }
			add_to_variable = { sov_congress_psr_seats = sov_congress_seats_change }
		}
		else = {
			set_temp_variable = { divider = -3 }
			divide_temp_variable = { sov_congress_seats_change = divider }
		}
		add_to_variable = { sov_congress_plsr_seats = sov_congress_seats_change }
		add_to_variable = { sov_congress_nsp_seats = sov_congress_seats_change }
		add_to_variable = { sov_congress_rsdrp_seats = sov_congress_seats_change }	
	}
}
SOV_soviet_congress_increase_plsr = {
	custom_effect_tooltip = SOV_soviet_congress_increase_plsr
	add_popularity = { ideology = syndicalist popularity = 0.05 }
	set_temp_variable = { sov_congress_seats_change = 0.05 }
	add_to_variable = { sov_congress_plsr_seats = sov_congress_seats_change }
	set_temp_variable = { divider = -2 }
	if = {
		limit = { 
			NOT = { has_country_flag = psr_banned }
		}
		add_to_temp_variable = { divider = -1 }
	}
	divide_temp_variable = { sov_congress_seats_change = divider }	
	if = {
		limit = { 
			NOT = { has_country_flag = psr_banned }
		}
		add_to_temp_variable = { sov_congress_psr_seats = sov_congress_seats_change }
	}
	add_to_variable = { sov_congress_nsp_seats = sov_congress_seats_change }
	add_to_variable = { sov_congress_rsdrp_seats = sov_congress_seats_change }	
}
SOV_soviet_congress_increase_psr = {
	if = {
		limit = { 
			NOT = { has_country_flag = psr_banned }
		}
		custom_effect_tooltip = SOV_soviet_congress_increase_psr
		add_popularity = { ideology = radical_socialist popularity = 0.05 }
		set_temp_variable = { sov_congress_seats_change = 0.05 }
		add_to_variable = { sov_congress_psr_seats = sov_congress_seats_change }
		set_temp_variable = { divider = -3 }
		divide_temp_variable = { sov_congress_seats_change = divider }
		add_to_variable = { sov_congress_plsr_seats = sov_congress_seats_change }
		add_to_variable = { sov_congress_nsp_seats = sov_congress_seats_change }
		add_to_variable = { sov_congress_rsdrp_seats = sov_congress_seats_change }	
	}
}
SOV_soviet_congress_increase_nsp = {
	custom_effect_tooltip = SOV_soviet_congress_increase_nsp
	add_popularity = { ideology = radical_socialist popularity = 0.05 }
	set_temp_variable = { sov_congress_seats_change = 0.05 }
	add_to_variable = { sov_congress_nsp_seats = sov_congress_seats_change }
	set_temp_variable = { divider = -2 }
	if = {
		limit = { 
			NOT = { has_country_flag = psr_banned }
		}
		add_to_temp_variable = { divider = -1 }
	}
	divide_temp_variable = { sov_congress_seats_change = divider }	
	if = {
		limit = { 
			NOT = { has_country_flag = psr_banned }
		}
		add_to_temp_variable = { sov_congress_psr_seats = sov_congress_seats_change }
	}
	add_to_variable = { sov_congress_plsr_seats = sov_congress_seats_change }
	add_to_variable = { sov_congress_rsdrp_seats = sov_congress_seats_change }	
}
SOV_soviet_congress_increase_rsdrp = {
	custom_effect_tooltip = SOV_soviet_congress_increase_rsdrp
	add_popularity = { ideology = social_democrat popularity = 0.05 }
	set_temp_variable = { sov_congress_seats_change = 0.05 }
	add_to_variable = { sov_congress_rsdrp_seats = sov_congress_seats_change }
	set_temp_variable = { divider = -2 }
	if = {
		limit = { 
			NOT = { has_country_flag = psr_banned }
		}
		add_to_temp_variable = { divider = -1 }
	}
	divide_temp_variable = { sov_congress_seats_change = divider }	
	if = {
		limit = { 
			NOT = { has_country_flag = psr_banned }
		}
		add_to_temp_variable = { sov_congress_psr_seats = sov_congress_seats_change }
	}
	add_to_variable = { sov_congress_plsr_seats = sov_congress_seats_change }
	add_to_variable = { sov_congress_nsp_seats = sov_congress_seats_change }	
}
SOV_run_election = {
	set_variable = { SOV_total_votes = 0 }
	
	every_owned_state = {
		set_variable = { SOV_total_state_votes = state_population_k }
		divide_variable = { SOV_total_state_votes = 125 }		
		round_variable = SOV_total_state_votes
		
		add_to_variable = { PREV.SOV_total_votes = SOV_total_state_votes }		
	}
	round_variable = SOV_total_votes
	
	add_to_variable = { sov_congress_plsr_seats = sov_congress_sum_1 }
	add_to_variable = { sov_congress_nsp_seats = sov_congress_sum_1 }
	add_to_variable = { sov_congress_rsdrp_seats = sov_congress_sum_1 }	
	
	set_variable = { SOV_plsr_votes = sov_congress_plsr_seats }
	multiply_variable = { SOV_plsr_votes = SOV_total_votes }
	round_variable = SOV_plsr_votes
	
	set_variable = { SOV_nsp_votes = sov_congress_nsp_seats }
	multiply_variable = { SOV_nsp_votes = SOV_total_votes }
	round_variable = SOV_nsp_votes
	
	set_variable = { SOV_psr_votes = sov_congress_psr_seats }
	multiply_variable = { SOV_psr_votes = SOV_total_votes }
	round_variable = SOV_psr_votes
	
	set_variable = { SOV_rsdrp_votes = sov_congress_rsdrp_seats }
	multiply_variable = { SOV_rsdrp_votes = SOV_total_votes }
	round_variable = SOV_rsdrp_votes	
	
	log = "[THIS.GetName]: PLSR([?SOV_plsr_votes]) - NSP([?SOV_nsp_votes]) - RSDRP([?SOV_rsdrp_votes]) - PSR([?SOV_psr_votes]) - TOTAL([?SOV_total_votes])"
}
SOV_increase_bukharin = {
	custom_effect_tooltip = SOV_increase_bukharin_tt
	add_to_variable = { SOV_bukharin_influence = 1 }
}
SOV_decrease_bukharin = {
	custom_effect_tooltip = SOV_decrease_bukharin_tt
	add_to_variable = { SOV_bukharin_influence = -1 }
}
SOV_increase_tomsky = {
	custom_effect_tooltip = SOV_increase_tomsky_tt
	add_to_variable = { SOV_tomsky_influence = 1 }
}
SOV_decrease_tomsky = {
	custom_effect_tooltip = SOV_decrease_tomsky_tt
	add_to_variable = { SOV_tomsky_influence = -1 }
}
SOV_increase_rykov = {
	custom_effect_tooltip = SOV_increase_rykov_tt
	add_to_variable = { SOV_rykov_influence = 1 }
}
SOV_decrease_rykov = {
	custom_effect_tooltip = SOV_decrease_rykov_tt
	add_to_variable = { SOV_rykov_influence = -1 }
}
SOV_increase_kirov = {
	custom_effect_tooltip = SOV_increase_kirov_tt
	add_to_variable = { SOV_kirov_influence = 1 }
}
SOV_decrease_kirov = {
	custom_effect_tooltip = SOV_decrease_kirov_tt
	add_to_variable = { SOV_kirov_influence = -1 }
}
SOV_increase_activist = {
	custom_effect_tooltip = SOV_increase_activists_tt
	add_to_variable = { SOV_activist_influence = 1 }
}
SOV_decrease_activist = {
	custom_effect_tooltip = SOV_decrease_activists_tt
	add_to_variable = { SOV_activist_influence = -1 }
}
SOV_increase_chekist = {
	custom_effect_tooltip = SOV_increase_chekists_tt
	add_to_variable = { SOV_chekist_influence = 1 }
}
SOV_decrease_chekist = {
	custom_effect_tooltip = SOV_decrease_chekists_tt
	add_to_variable = { SOV_chekist_influence = -1 }
}
SOV_increase_legalist = {
	custom_effect_tooltip = SOV_increase_legalists_tt
	add_to_variable = { SOV_legalist_influence = 1 }
}
SOV_decrease_legalist = {
	custom_effect_tooltip = SOV_decrease_legalists_tt
	add_to_variable = { SOV_legalist_influence = -1 }
}
SOV_break_puppet_effect = {
	if = {
		limit = { 
			OR = { 
				has_autonomy_state = kr_autonomous_soviet_republic
				has_autonomy_state = kr_labour_commune
				has_autonomy_state = kr_soviet_republic_not_equal
				has_autonomy_state = kr_soviet_republic_equal
			}
		}
		leave_faction = yes
		overlord = {
			set_temp_variable = { former_overlord = THIS }
			set_autonomy = {
				target = PREV
				autonomy_state = autonomy_free
			}
		}
		peace_out_non_neighbours_after_leaving_faction = yes		
	}
}
SOV_puppet_ROOT_effect = {
	hidden_effect = {
		set_temp_variable = { new_overlord = THIS }
		ROOT = {
			get_current_government_type = yes
			every_subject_country = {
				get_current_government_type = yes
				if = {
					limit = { is_possible_equal_soviet_republic_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_soviet_republic_equal
							end_wars = no
						}
					}
				}
				else_if = {
					limit = { is_possible_soviet_republic_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_soviet_republic_not_equal
							end_wars = no
						}
					}
				}
				else_if = {
					limit = { is_possible_autonomous_soviet_republic_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_autonomous_soviet_republic
							end_wars = no
						}
					}
				}
				restore_previous_government_type = yes
			}
		}
	}
	if = {
		limit = { ROOT = { is_possible_equal_soviet_republic_tag = yes } }
		set_autonomy = {
			target = ROOT
			autonomy_state = kr_soviet_republic_equal
			end_wars = no
		}
	}
	else_if = {
		limit = { ROOT = { is_possible_soviet_republic_tag = yes } }
		set_autonomy = {
			target = ROOT
			autonomy_state = kr_soviet_republic_not_equal
			end_wars = no
		}
	}
	else_if = {
		limit = { ROOT = { is_possible_autonomous_soviet_republic_tag = yes } }
		set_autonomy = {
			target = ROOT
			autonomy_state = kr_autonomous_soviet_republic
			end_wars = no
		}
	}
	hidden_effect = {
		ROOT = { restore_previous_government_type = yes }
	}
}

SOV_puppet_PREV_effect = {
	hidden_effect = {
		set_temp_variable = { new_overlord = THIS }
		PREV = {
			get_current_government_type = yes
			every_subject_country = {
				get_current_government_type = yes
				if = {
					limit = { is_possible_equal_soviet_republic_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_soviet_republic_equal
							end_wars = no
						}
					}
				}
				else_if = {
					limit = { is_possible_soviet_republic_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_soviet_republic_not_equal
							end_wars = no
						}
					}
				}
				else_if = {
					limit = { is_possible_autonomous_soviet_republic_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_autonomous_soviet_republic
							end_wars = no
						}
					}
				}
				restore_previous_government_type = yes
			}
		}
	}
	if = {
		limit = { PREV = { is_possible_equal_soviet_republic_tag = yes } }
		set_autonomy = {
			target = PREV
			autonomy_state = kr_soviet_republic_equal
			end_wars = no
		}
	}
	else_if = {
		limit = { PREV = { is_possible_soviet_republic_tag = yes } }
		set_autonomy = {
			target = PREV
			autonomy_state = kr_soviet_republic_not_equal
			end_wars = no
		}
	}
	else_if = {
		limit = { PREV = { is_possible_autonomous_soviet_republic_tag = yes } }
		set_autonomy = {
			target = PREV
			autonomy_state = kr_autonomous_soviet_republic
			end_wars = no
		}
	}
	hidden_effect = {
		PREV = { restore_previous_government_type = yes }
	}	
}

SOV_puppet_FROM_effect = {
	hidden_effect = {
		set_temp_variable = { new_overlord = THIS }
		FROM = {
			get_current_government_type = yes
			every_subject_country = {
				get_current_government_type = yes
				if = {
					limit = { is_possible_equal_soviet_republic_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = var:target
							autonomy_state = kr_soviet_republic_equal
							end_wars = no
						}
					}
				}
				else_if = {
					limit = { is_possible_soviet_republic_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = var:target
							autonomy_state = kr_soviet_republic_not_equal
							end_wars = no
						}
					}
				}
				else_if = {
					limit = { is_possible_autonomous_soviet_republic_tag = yes }
					var:new_overlord = {
						set_autonomy = {
							target = PREV
							autonomy_state = kr_autonomous_soviet_republic
							end_wars = no
						}
					}
				}
				restore_previous_government_type = yes
			}
		}
	}
	if = {
		limit = { FROM = { is_possible_equal_soviet_republic_tag = yes } }
		set_autonomy = {
			target = FROM
			autonomy_state = kr_soviet_republic_equal
			end_wars = no
		}
	}
	else_if = {
		limit = { FROM = { is_possible_soviet_republic_tag = yes } }
		set_autonomy = {
			target = FROM
			autonomy_state = kr_soviet_republic_not_equal
			end_wars = no
		}
	}
	else_if = {
		limit = { FROM = { is_possible_autonomous_soviet_republic_tag = yes } }
		set_autonomy = {
			target = FROM
			autonomy_state = kr_autonomous_soviet_republic
			end_wars = no
		}
	}
	hidden_effect = {
		FROM = { restore_previous_government_type = yes }
	}	
}

SOV_puppet_TARGET_effect = {
	hidden_effect = { var:target = { get_current_government_type = yes } }
	if = {
		limit = { var:target = { is_possible_equal_soviet_republic_tag = yes } }
		set_autonomy = {
			target = var:target
			autonomy_state = kr_soviet_republic_equal
			end_wars = no
		}
	}
	else_if = {
		limit = { var:target = { is_possible_soviet_republic_tag = yes } }
		set_autonomy = {
			target = var:target
			autonomy_state = kr_soviet_republic_not_equal
			end_wars = no
		}
	}
	else_if = {
		limit = { var:target = { is_possible_autonomous_soviet_republic_tag = yes } }
		set_autonomy = {
			target = var:target
			autonomy_state = kr_autonomous_soviet_republic
			end_wars = no
		}
	}
	hidden_effect = {
		var:target = { restore_previous_government_type = yes }
	}
}
SOV_integrate_TARGET_effect = {
	set_temp_variable = { integrator = THIS }
	event_target:target = {
		every_subject_country = {
			custom_effect_tooltip = tooltip_white_line
			get_current_government_type = yes
			var:integrator = { puppet = PREV }
			restore_previous_government_type = yes
		}
		every_owned_state = {
			limit = { is_core_of = PREV }
			add_core_of = var:integrator
		}
	}
	custom_effect_tooltip = tooltip_white_line
	if = {
		limit = { event_target:target = { tag = KUB } }
		event_target:target = {
			every_unit_leader = {
				set_unit_leader_flag = KUB_original_leaders
				set_nationality = var:integrator
			}
		}
	}
	else_if = {
		limit = { event_target:target = { tag = TRM } }
		event_target:target = {
			every_unit_leader = {
				set_unit_leader_flag = KUB_original_leaders
				set_nationality = var:integrator
			}
		}
		set_country_flag = RUS_cannot_release_TRM
	}
	
	annex_country = {
		target = event_target:target
		transfer_troops = yes
	}
	if = {
		limit = { event_target:target = { is_ai = no } }
		change_tag_from = event_target:target
	}
}