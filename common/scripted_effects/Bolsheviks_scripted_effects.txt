
### SOVNARKOM ###
SOV_setup_politburo = {
	# add_to_array = { Politburo_Leader_Identity= <d> }	# Leader ID
	# add_to_array = { Politburo_Leader_Status = <d> }	# 0 for Zinovievites, 1 for Right Lean, 2 for Hardliners, 3 for Sit-out
	# add_to_array = { Politburo_Leader_Authority= <d> }	# authority variable
	# NULL #
	add_to_array = { Politburo_Leader_Identity		= 1		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	add_to_array = { Politburo_Leader_Authority		= 0		}
	# Zinoviev #
	add_to_array = { Politburo_Leader_Identity		= 2		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	add_to_array = { Politburo_Leader_Authority		= 10	}
	# Kamenev #
	add_to_array = { Politburo_Leader_Identity		= 3		}
	add_to_array = { Politburo_Leader_Status		= 3		}
	add_to_array = { Politburo_Leader_Authority		= 7		}
	# Blagonravov #
	add_to_array = { Politburo_Leader_Identity		= 4		}
	add_to_array = { Politburo_Leader_Status		= 0		}
	add_to_array = { Politburo_Leader_Authority		= 6		}
	# Sokolnikov #
	add_to_array = { Politburo_Leader_Identity		= 5		}
	add_to_array = { Politburo_Leader_Status		= 1		}
	add_to_array = { Politburo_Leader_Authority		= 5		}
	# Kalinin #
	add_to_array = { Politburo_Leader_Identity		= 6		}
	add_to_array = { Politburo_Leader_Status		= 1		}
	add_to_array = { Politburo_Leader_Authority		= 5		}
	# Molotov #
	add_to_array = { Politburo_Leader_Identity		= 7		}
	add_to_array = { Politburo_Leader_Status		= 2		}
	add_to_array = { Politburo_Leader_Authority		= 6		}
	# Krestinskiy #
	add_to_array = { Politburo_Leader_Identity		= 8		}
	add_to_array = { Politburo_Leader_Status		= 2		}
	add_to_array = { Politburo_Leader_Authority		= 5		}
	# Mayakovsky #
	add_to_array = { Politburo_Leader_Identity		= 9		}
	add_to_array = { Politburo_Leader_Status		= 3		}
	add_to_array = { Politburo_Leader_Authority		= 4		}
	# Gastev #
	add_to_array = { Politburo_Leader_Identity		= 10	}
	add_to_array = { Politburo_Leader_Status		= 3		}
	add_to_array = { Politburo_Leader_Authority		= 5		}
	# Lunacharsky #
	add_to_array = { Politburo_Leader_Identity		= 11	}
	add_to_array = { Politburo_Leader_Status		= 3		}
	add_to_array = { Politburo_Leader_Authority		= 5		}
	# Kaganovich #
	add_to_array = { Politburo_Leader_Identity		= 12	}
	add_to_array = { Politburo_Leader_Status		= 3		}
	add_to_array = { Politburo_Leader_Authority		= 2		}
	# Yagoda #
	add_to_array = { Politburo_Leader_Identity		= 13	}
	add_to_array = { Politburo_Leader_Status		= 3		}
	add_to_array = { Politburo_Leader_Authority		= 2		}
	# Yezhov #
	add_to_array = { Politburo_Leader_Identity		= 14	}
	add_to_array = { Politburo_Leader_Status		= 3		}
	add_to_array = { Politburo_Leader_Authority		= 0		}
	
	set_country_flag = SOV_politburo_active
	activate_mission = SOV_preparing_for_zinovievs_rally
	SOV_calculate_politburo_factions = yes
	
}
SOV_calculate_politburo_factions = {
	set_variable = { Politburo_Centre_Faction = 0 }
	set_variable = { Politburo_Right_Faction = 0 }
	set_variable = { Politburo_Hardliner_Faction = 0 }
	# Zinovievites #
	for_each_loop = {
		array = Politburo_Leader_Status
		value = value
		index = i
		
		if = {
			limit = { check_variable = { Politburo_Leader_Status^i = 0 } }
			add_to_variable = { Politburo_Centre_Faction = Politburo_Leader_Authority^i }
		}
		else_if = {
			limit = { check_variable = { Politburo_Leader_Status^i = 1 } }
			add_to_variable = { Politburo_Right_Faction = Politburo_Leader_Authority^i }
		}
		else_if = {
			limit = { check_variable = { Politburo_Leader_Status^i = 2 } }
			add_to_variable = { Politburo_Hardliner_Faction = Politburo_Leader_Authority^i }
		}
	}
}
remove_sovnarkom = {
	clr_country_flag = SOV_sovnarkom_established
	set_country_flag = SOV_sovnarkom_dissolved 	
}

politburo_change_zinoviev_authority = {
	if = {
		limit = {
			NOT = { has_country_flag = zinoviev_dead }
		}
		# tooltip
		effect_tooltip = {
			add_to_variable = {
				Politburo_Leader_Authority^1 = politburo_var_change
				tooltip = politburo_change_zinoviev_authority_tooltip
			}
		}

		# lower limit = influence * -1
		set_temp_variable = { SOV_lower_limit = Politburo_Leader_Authority^1 }
		multiply_temp_variable = { SOV_lower_limit = -1 }

		# avoid values outside the allowed range
		clamp_temp_variable = {
			var = politburo_var_change
			min = SOV_lower_limit
		}

		# add the variable
		add_to_variable = { Politburo_Leader_Authority^1 = politburo_var_change }
		SOV_calculate_politburo_factions = yes
	}
}
politburo_change_kamenev_authority = {
	if = {
		limit = {
			NOT = { has_country_flag = kamenev_dead }
		}
		# tooltip
		effect_tooltip = {
			add_to_variable = {
				Politburo_Leader_Authority^2 = politburo_var_change
				tooltip = politburo_change_kamenev_authority_tooltip
			}
		}

		# lower limit = influence * -1
		set_temp_variable = { SOV_lower_limit = Politburo_Leader_Authority^2 }
		multiply_temp_variable = { SOV_lower_limit = -1 }

		# avoid values outside the allowed range
		clamp_temp_variable = {
			var = politburo_var_change
			min = SOV_lower_limit
		}

		# add the variable
		add_to_variable = { Politburo_Leader_Authority^2 = politburo_var_change }
		SOV_calculate_politburo_factions = yes
	}
}
politburo_change_blagonravov_authority = {
	if = {
		limit = {
			NOT = { has_country_flag = blagonravov_dead }
		}
		# tooltip
		effect_tooltip = {
			add_to_variable = {
				Politburo_Leader_Authority^3 = politburo_var_change
				tooltip = politburo_change_blagonravov_authority_tooltip
			}
		}

		# lower limit = influence * -1
		set_temp_variable = { SOV_lower_limit = Politburo_Leader_Authority^3 }
		multiply_temp_variable = { SOV_lower_limit = -1 }

		# avoid values outside the allowed range
		clamp_temp_variable = {
			var = politburo_var_change
			min = SOV_lower_limit
		}

		# add the variable
		add_to_variable = { Politburo_Leader_Authority^3 = politburo_var_change }
		SOV_calculate_politburo_factions = yes
	}
}
politburo_change_sokolnikov_authority = {
	if = {
		limit = {
			NOT = { has_country_flag = sokolnikov_dead }
		}
		# tooltip
		effect_tooltip = {
			add_to_variable = {
				Politburo_Leader_Authority^4 = politburo_var_change
				tooltip = politburo_change_sokolnikov_authority_tooltip
			}
		}

		# lower limit = influence * -1
		set_temp_variable = { SOV_lower_limit = Politburo_Leader_Authority^4 }
		multiply_temp_variable = { SOV_lower_limit = -1 }

		# avoid values outside the allowed range
		clamp_temp_variable = {
			var = politburo_var_change
			min = SOV_lower_limit
		}

		# add the variable
		add_to_variable = { Politburo_Leader_Authority^4 = politburo_var_change }
		SOV_calculate_politburo_factions = yes
	}
}
politburo_change_kalinin_authority = {
	if = {
		limit = {
			NOT = { has_country_flag = kalinin_dead }
		}
		# tooltip
		effect_tooltip = {
			add_to_variable = {
				Politburo_Leader_Authority^5 = politburo_var_change
				tooltip = politburo_change_kalinin_authority_tooltip
			}
		}

		# lower limit = influence * -1
		set_temp_variable = { SOV_lower_limit = Politburo_Leader_Authority^5 }
		multiply_temp_variable = { SOV_lower_limit = -1 }

		# avoid values outside the allowed range
		clamp_temp_variable = {
			var = politburo_var_change
			min = SOV_lower_limit
		}

		# add the variable
		add_to_variable = { Politburo_Leader_Authority^5 = politburo_var_change }
		SOV_calculate_politburo_factions = yes
	}
}
politburo_change_molotov_authority = {
	if = {
		limit = {
			NOT = { has_country_flag = molotov_dead }
		}
		# tooltip
		effect_tooltip = {
			add_to_variable = {
				Politburo_Leader_Authority^6 = politburo_var_change
				tooltip = politburo_change_molotov_authority_tooltip
			}
		}

		# lower limit = influence * -1
		set_temp_variable = { SOV_lower_limit = Politburo_Leader_Authority^6 }
		multiply_temp_variable = { SOV_lower_limit = -1 }

		# avoid values outside the allowed range
		clamp_temp_variable = {
			var = politburo_var_change
			min = SOV_lower_limit
		}

		# add the variable
		add_to_variable = { Politburo_Leader_Authority^6 = politburo_var_change }
		SOV_calculate_politburo_factions = yes
	}
}
politburo_change_krestinsky_authority = {
	if = {
		limit = {
			NOT = { has_country_flag = kaganovich_dead }
		}
		# tooltip
		effect_tooltip = {
			add_to_variable = {
				Politburo_Leader_Authority^7 = politburo_var_change
				tooltip = politburo_change_krestinsky_authority_tooltip
			}
		}

		# lower limit = influence * -1
		set_temp_variable = { SOV_lower_limit = Politburo_Leader_Authority^7 }
		multiply_temp_variable = { SOV_lower_limit = -1 }

		# avoid values outside the allowed range
		clamp_temp_variable = {
			var = politburo_var_change
			min = SOV_lower_limit
		}

		# add the variable
		add_to_variable = { Politburo_Leader_Authority^7 = politburo_var_change }
		SOV_calculate_politburo_factions = yes
	}
}

politburo_change_mayakovsky_authority = {
	if = {
		limit = { has_country_flag = mayakovsky_returned }
		# tooltip
		effect_tooltip = {
			add_to_variable = {
				Politburo_Leader_Authority^8 = politburo_var_change
				tooltip = politburo_change_mayakovsky_authority_tooltip
			}
		}

		# lower limit = influence * -1
		set_temp_variable = { SOV_lower_limit = Politburo_Leader_Authority^8 }
		multiply_temp_variable = { SOV_lower_limit = -1 }

		# avoid values outside the allowed range
		clamp_temp_variable = {
			var = politburo_var_change
			min = SOV_lower_limit
		}

		# add the variable
		add_to_variable = { Politburo_Leader_Authority^8 = politburo_var_change }
		SOV_calculate_politburo_factions = yes
	}
}
politburo_change_gastev_authority = {
	if = {
		limit = {
			NOT = { has_country_flag = gastev_dead }
		}
		# tooltip
		effect_tooltip = {
			add_to_variable = {
				Politburo_Leader_Authority^9 = politburo_var_change
				tooltip = politburo_change_gastev_authority_tooltip
			}
		}

		# lower limit = influence * -1
		set_temp_variable = { SOV_lower_limit = Politburo_Leader_Authority^9 }
		multiply_temp_variable = { SOV_lower_limit = -1 }

		# avoid values outside the allowed range
		clamp_temp_variable = {
			var = politburo_var_change
			min = SOV_lower_limit
		}

		# add the variable
		add_to_variable = { Politburo_Leader_Authority^9 = politburo_var_change }
		SOV_calculate_politburo_factions = yes
	}
}
politburo_change_lunacharsky_authority = {
	if = {
		limit = {
			NOT = { has_country_flag = lunacharsky_dead }
		}
		# tooltip
		effect_tooltip = {
			add_to_variable = {
				Politburo_Leader_Authority^10 = politburo_var_change
				tooltip = politburo_change_lunacharsky_authority_tooltip
			}
		}

		# lower limit = influence * -1
		set_temp_variable = { SOV_lower_limit = Politburo_Leader_Authority^10 }
		multiply_temp_variable = { SOV_lower_limit = -1 }

		# avoid values outside the allowed range
		clamp_temp_variable = {
			var = politburo_var_change
			min = SOV_lower_limit
		}

		# add the variable
		add_to_variable = { Politburo_Leader_Authority^10 = politburo_var_change }
		SOV_calculate_politburo_factions = yes
	}
}

politburo_change_kaganovich_authority = {
	# tooltip
	effect_tooltip = {
		add_to_variable = {
			Politburo_Leader_Authority^11 = politburo_var_change
			tooltip = politburo_change_kaganovich_authority_tooltip
		}
	}

	# lower limit = influence * -1
	set_temp_variable = { SOV_lower_limit = Politburo_Leader_Authority^11 }
	multiply_temp_variable = { SOV_lower_limit = -1 }

	# avoid values outside the allowed range
	clamp_temp_variable = {
		var = politburo_var_change
		min = SOV_lower_limit
	}

	# add the variable
	add_to_variable = { Politburo_Leader_Authority^11 = politburo_var_change }
	SOV_calculate_politburo_factions = yes
}

setup_cultural_revolution_proletkult = {
	set_country_flag = SOV_proletkult_ongoing
	ROOT = {
		add_dynamic_modifier = {
			modifier = SOV_Cultural_Revolution_proletkult_modifier
		}
		hidden_effect = { add_ideas = SOV_cultural_revolution_proletkult_idea }
		unlock_decision_category_tooltip = SOV_Cultural_Revolution_Proletkult_decisions 
	}
	set_variable = { SOV_proletkult_level_of_education = 57 }
	set_variable = { SOV_proletkult_level_of_illiteracy = 46 }
	set_variable = { SOV_proletkult_level_of_proletarian_ethics = 20 }
	recalculate_proletkult_revolution_effects = yes

}
recalculate_proletkult_revolution_effects = {
	set_temp_variable = { temp1 = -0.01 }
	set_temp_variable = { temp2 = 0.01 }
	set_temp_variable = { temp3 = 0.01 }
	set_temp_variable = { temp4 = -0.2 }
	set_temp_variable = { temp5 = -0.2 }
	if = {
		limit = {
			has_completed_focus = SOV_Forging_Soviet_Identity
		}
		add_to_temp_variable = { temp1 = -0.01 }
		add_to_temp_variable = { temp2 = 0.01 }
		add_to_temp_variable = { temp3 = 0.01 }
		add_to_temp_variable = { temp4 = 0.025 }
		add_to_temp_variable = { temp5 = 0.025 }
	}
	if = {
		limit = {
			has_completed_focus = SOV_Embrace_Modern_Art
		}
		add_to_temp_variable = { temp3 = -0.01 }
		add_to_temp_variable = { temp4 = 0.025 }
		add_to_temp_variable = { temp5 = 0.025 }
	}
	if = {
		limit = {
			has_completed_focus = SOV_Soviet_Intelligentsia
		}
		add_to_temp_variable = { temp1 = -0.01 }
		add_to_temp_variable = { temp2 = 0.01 }
		add_to_temp_variable = { temp3 = -0.02 }
		add_to_temp_variable = { temp4 = 0.025 }
		add_to_temp_variable = { temp5 = 0.025 }
	}
	if = {
		limit = {
			has_completed_focus = SOV_Oppress_Philistines
		}
		add_to_temp_variable = { temp3 = -0.02 }
		add_to_temp_variable = { temp4 = 0.025 }
		add_to_temp_variable = { temp5 = 0.025 }
	}
	if = {
		limit = {
			has_completed_focus = SOV_Social_Engineering
		}
		add_to_temp_variable = { temp1 = -0.02 }
		add_to_temp_variable = { temp2 = 0.02 }
		add_to_temp_variable = { temp3 = 0.02 }
		add_to_temp_variable = { temp4 = 0.025 }
		add_to_temp_variable = { temp5 = 0.025 }
	}
	if = {
		limit = {
			has_completed_focus = SOV_Time_Forward
		}
		add_to_temp_variable = { temp1 = -0.01 }
		add_to_temp_variable = { temp2 = 0.01 }
		add_to_temp_variable = { temp3 = 0.01 }
		add_to_temp_variable = { temp4 = 0.025 }
		add_to_temp_variable = { temp5 = 0.025 }
	}
	if = {
		limit = {
			has_completed_focus = SOV_Cult_Of_Reason
		}
		add_to_temp_variable = { temp1 = -0.01 }
		add_to_temp_variable = { temp2 = 0.01 }
		add_to_temp_variable = { temp3 = -0.01 }
		add_to_temp_variable = { temp4 = 0.025 }
		add_to_temp_variable = { temp5 = 0.025 }
	}
	if = {
		limit = {
			has_completed_focus = SOV_Godbuilding
		}
		add_to_temp_variable = { temp3 = -0.01 }
		add_to_temp_variable = { temp4 = 0.025 }
		add_to_temp_variable = { temp5 = 0.025 }
	}
	if = {
		limit = {
			has_completed_focus = SOV_Bolshevist_Enlightenment
		}
		add_to_temp_variable = { temp1 = -0.01 }
		add_to_temp_variable = { temp2 = 0.02 }
		add_to_temp_variable = { temp3 = 0.01 }
		add_to_temp_variable = { temp4 = 0.025 }
		add_to_temp_variable = { temp5 = 0.025 }
	}
	
	set_variable = { SOV_culrev_level_of_illiteracy_monthly_rate = temp1 }
	set_variable = { SOV_culrev_level_of_education_monthly_rate = temp2 }
	set_variable = { SOV_culrev_level_of_proletarian_ethics = temp3 }
	set_variable = { SOV_culrev_stability = temp4 }
	set_variable = { SOV_culrev_war_support = temp5 }
}
recalculate_proletkult_revolution_effects_daily = {
	add_to_variable = { SOV_proletkult_level_of_education = modifier@level_of_education_monthly_rate }
	add_to_variable = { SOV_proletkult_level_of_illiteracy = modifier@level_of_illiteracy_monthly_rate }
	add_to_variable = { SOV_proletkult_level_of_proletarian_ethics = modifier@level_of_proletarian_ethics }
	clamp_variable = {
		var = SOV_proletkult_level_of_education
		min = 0
		max = 100
	}
	clamp_variable = {
		var = SOV_proletkult_level_of_illiteracy
		min = 0
		max = 100
	}
	clamp_variable = {
		var = SOV_proletkult_level_of_proletarian_ethics
		min = 0
		max = 100
	}
}

SOV_move_towards_soviets = {
	custom_effect_tooltip = SOV_soviet_influence_will_rise
	if = {
		limit = {
			has_idea = SOV_soviet_syndicalist_tu 
		}
		remove_ideas = SOV_soviet_syndicalist_tu
		add_ideas = SOV_soviet_syndicalist_balance
	}
	else_if = {
		limit = {
			has_idea = SOV_soviet_syndicalist_balance
		}
		remove_ideas = SOV_soviet_syndicalist_soviet
		add_ideas = SOV_soviet_syndicalist_soviet
	}
}
SOV_move_towards_syndicates = {
	custom_effect_tooltip = SOV_syndicate_influence_will_rise
	if = {
		limit = {
			has_idea = SOV_soviet_syndicalist_soviet
		}
		remove_ideas = SOV_soviet_syndicalist_soviet
		add_ideas = SOV_soviet_syndicalist_balance
	}
	else_if = {
		limit = {
			has_idea = SOV_soviet_syndicalist_balance
		}
		remove_ideas = SOV_soviet_syndicalist_balance
		add_ideas = SOV_soviet_syndicalist_tu
	}
}		
